<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Richard Yang, Java Developer, Senior software engineer" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="A birdview of core java concurrency
Concepts

Procting shared dataJava provides Lock-based concurrency control machanism. Locking establishes the orderings needed to satisfy the Java Memory Model and">
<meta property="og:type" content="article">
<meta property="og:title" content="Core Java Concurrency">
<meta property="og:url" content="https://richyang.me/2015/03/13/core-java-concurrency/index.html">
<meta property="og:site_name" content="Richard Yang">
<meta property="og:description" content="A birdview of core java concurrency
Concepts

Procting shared dataJava provides Lock-based concurrency control machanism. Locking establishes the orderings needed to satisfy the Java Memory Model and">
<meta property="og:image" content="https://richyang.me/media/core-java-concurrency.png">
<meta property="og:image" content="https://richyang.me/media/table1.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-lists-sets.png">
<meta property="og:image" content="https://richyang.me/file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/5a59455f-283a-4866-8f6b-3dc0c08f7c6a.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-map-methods.png">
<meta property="og:image" content="https://richyang.me/file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/289ebe3f-9f50-4c78-bff7-2d9f1fbc287a.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-map.png">
<meta property="og:image" content="https://richyang.me/file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/5a4f4218-f143-409f-a1c0-98c707b9dcaa.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-queue-methods.png">
<meta property="og:image" content="https://richyang.me/file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/b374c6dd-f4ae-4fe3-96fb-80233b3e1299.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-queue.png">
<meta property="og:image" content="https://richyang.me/file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/307ab1f8-64da-4916-a6a7-ef6b431af845.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-deu-methods.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-deque.png">
<meta property="og:image" content="https://richyang.me/file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/31906fc7-031c-4660-89d5-406daac22202.png">
<meta property="og:image" content="https://richyang.me/media/table-concurrent-thread.png">
<meta property="og:image" content="https://richyang.me/media/thread-inference.png">
<meta property="og:image" content="https://richyang.me/media/thread-current-context.png">
<meta property="og:image" content="https://richyang.me/file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/159e3222-f1a3-4ba4-806e-a79d29896d45.png">
<meta property="og:image" content="https://richyang.me/media/CyclicBarrier.png">
<meta property="og:image" content="https://richyang.me/media/CountdownLatch.png">
<meta property="og:updated_time" content="2015-12-05T04:46:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Core Java Concurrency">
<meta name="twitter:description" content="A birdview of core java concurrency
Concepts

Procting shared dataJava provides Lock-based concurrency control machanism. Locking establishes the orderings needed to satisfy the Java Memory Model and">
<meta name="twitter:image" content="https://richyang.me/media/core-java-concurrency.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    },
    algolia: {
      applicationID: 'X0H1P7HDKY',
      apiKey: 'ddc0af00a6e07c9b1be9f4da4cf5b9d9',
      indexName: 'richyang.me',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>




  <title> Core Java Concurrency | Richard Yang </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <!--span class="logo-line-before"><i></i></span-->
      <span class="site-title">Richard Yang</span>
      <!--span class="logo-line-after"><i></i></span-->
    </a>
  </div>
  <p class="site-subtitle">Full-stack software engineer mainly focusing on Java-based technologies and web front-end</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Home
          </a>
        </li>
        
      
        
        
        <li class="menu-item menu-item-books">
          <a href="https://www.gitbook.com/@richdyang" rel="section">
            
            Books
          </a>
        </li>
        
      
        
        
        <li class="menu-item menu-item-showcase">
          <a href="/showcase" rel="section">
            
            Showcase
          </a>
        </li>
        
      
        
        
        <li class="menu-item menu-item-resume">
          <a href="http://linkedin.com/in/richdyang" rel="section">
            
            Résumé
          </a>
        </li>
        
      
        
        
      
        
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            About
          </a>
        </li>
        
      
        
        
      
        
        
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
            <i class="menu-item-icon fa fa-search fa-lg"></i>Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>

<div class="social-links" style="float: right; padding-left: 50px; margin-right: 10px">
      
        
          <span class="links-of-author-item">
            <a href="http://linkedin.com/in/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-linkedin"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://github.com/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-github-alt"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://bitbucket.org/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-bitbucket"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://stackoverflow.com/users/4344443/richard" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://twitter.com/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-twitter"></i>
                </span>
                 
              
            </a>
          </span>
        
      
  </div>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Core Java Concurrency
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-03-13T04:59:28+08:00" content="2015-03-13">
              2015-03-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Multithreading/" itemprop="url" rel="index">
                    <span itemprop="name">Multithreading</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/13/core-java-concurrency/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/03/13/core-java-concurrency/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="A-birdview-of-core-java-concurrency"><a href="#A-birdview-of-core-java-concurrency" class="headerlink" title="A birdview of core java concurrency"></a>A birdview of core java concurrency</h3><p><img src="/media/core-java-concurrency.png" alt="core-java-concurrency"></p>
<h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><div><img src="/media/table1.png" alt="table1"></div>

<h3 id="Procting-shared-data"><a href="#Procting-shared-data" class="headerlink" title="Procting shared data"></a>Procting shared data</h3><div>Java provides Lock-based concurrency control machanism. Locking <strong><span style="text-decoration: underline;">establishes the orderings</span></strong> needed to satisfy the Java Memory Model and <strong><span style="text-decoration: underline;">guarantee the visibility</span></strong> of changes to other threads.</div><br><div><br><br>#### Synchronized<br><br><div><br><br>Every object instance has a monitor that can be locked by one thread at a time. The _synchronized _keyword can be specifid on a method or in block form to lock the monitor. Modifying a field while synchronized on an object guarantees that subsequent reads from any other thread synchronized on the same object will see the updated value. It is important to note that writes outside synchronization or synchronized on a different object than the read are not necessarily ever visible to other threads.<br><div>The <em>synchronized</em> keyword can be specified on a method or in block form on a particular object instance. If specified on a non-static method, the <em>this</em> reference is used as the instance. In a synchronized static method, the Class defining the method is used as the instance.</div>

<h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h4><div>The java.util.concurrent.locks package has a standard Lock interface. The ReentrantLock implementation duplicates the functionality of the synchronized keyword but also provides additional functionality such as obtaining information about the state of the lock, non-blocking tryLock(), and interruptible locking.</div><br><div></div><br><div>Example of using a explicit ReentrantLock instance:</div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.lock();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> ++value;</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            lock.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br></div>

<h4 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h4><div>The java.util.concurrent.locks package also contains a ReadWriteLock interface (and ReentrantReadWriteLock implementation) which is defined by a pair of locks for reading and writing, typically allowing multiple concurrent readers but only one writer. Example of using an explicit ReentrantReadWriteLock to allow multiple concurrent readers:</div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">statistic</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReadWriteLock lock = <span class="keyword">new</span> ReentrantReadWriteLock();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.writeLock().lock();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            value++;</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            lock.writeLock().unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">current</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.readLock().lock();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> value;</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            lock.readLock().unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br></div>

<h4 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h4><div>The volatile modifier can be used to mark a field and indicate that changes to that field must be seen by all subsequent reads by other threads, regardless of synchronization. Thus, volatile provides visibility just like synchronization but scoped only to each read or write of the field. Before Java SE 5, the implementation of volatile was inconsitent between JVM implementations and architectures and could not be relied upon. The Java Memory Model now explicitly defines volatile’s behavior.</div><br><div></div><br><div>An example of using volatile as a signaling flag:</div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Processor</span> <span class="title">implments</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> stop;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopProcessing</span><span class="params">()</span> </span>&#123;</div><div class="line">        stop = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span>(!stop) &#123;</div><div class="line">            <span class="comment">//.. do processing</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br></div><br><div>Hot Tip: Marking an array as volatile does not make entries in the array volatile! In this case volatile applies only to the array reference itself. Instead, use a class like AtomicIntegerArray to create an array with volatile-like entries.</div>

<h4 id="Atomic-classes"><a href="#Atomic-classes" class="headerlink" title="Atomic classes"></a>Atomic classes</h4><div>One shorcoming of volatile is that while it provides visibility guarantees, you cannot both check and update a volatile field in a single atomic call. The java.util.concurrent.atomic package contains a set of classes that support atomic compound actions on a single value in a lock-free manner similar to volatile.</div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> AtomicInteger value = <span class="keyword">new</span> AtomicInteger();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> value.incrementAndGet();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br>Atomic classes are provided for booleans, integers, longs and object references as well as arrays of integers, longs, and object references.<br><br></div><br><div></div>

<h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h4><div>One way to contain data within a thread and make locking unnecessary is to use ThreadLocal storage. Conceptually a ThreadLocal acts as if there is a variable with its own version in every Thread. ThreadLocals are commonly used for stashing per-Thread values like the “current transaction” or other resources. Also, they are used to maintain per-thread counters, statistics, or ID generators.</div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManager</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&amp;lt;Transaction&amp;gt; currentTransaction = <span class="keyword">new</span> ThreadLocal&amp;lt;Transaction&amp;gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> Transaction <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> NullTransactin();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Transaction <span class="title">currentTransaction</span><span class="params">()</span> </span>&#123;</div><div class="line">        Transaction current = currentTransaction.get();</div><div class="line">        <span class="keyword">if</span>(current.isNull()) &#123;</div><div class="line">            current = <span class="keyword">new</span> TransactionImpl();</div><div class="line">            currentTransaction.put(current);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> current;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br></div>

<h3 id="Concurrent-collections"><a href="#Concurrent-collections" class="headerlink" title="Concurrent collections"></a>Concurrent collections</h3><div>A key technique for properly protecting shared data is to encapsulate the synchronization mechanism with the calss holding the data.</div><br><div>You can regard all plain objects as containers of its fields(data), but to get them thread-safe, you have to implement them one by one cautiously and seriously.</div><br><div>Collections are the container facilities Java provides for holding data and we use nearly everywhere.</div><br><div>This technique makes it impossible to improperly access the data as all usage must conform to the synchronization protocol. The java.util.concurrent package holds many data structures designed for concurrent use. Generally, the use of these data structures yields far better performance than using a synchronized wrapper around an unsynchronized collection.</div><br><div></div>

<h4 id="Concurrent-lists-and-sets"><a href="#Concurrent-lists-and-sets" class="headerlink" title="Concurrent lists and sets"></a>Concurrent lists and sets</h4><div> <img src="/media/table-concurrent-lists-sets.png" alt="table-concurrent-lists-sets"><img src="file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/5a59455f-283a-4866-8f6b-3dc0c08f7c6a.png" alt=""></div>

<h4 id="Concurrent-maps"><a href="#Concurrent-maps" class="headerlink" title="Concurrent maps"></a>Concurrent maps</h4><div>The java.util.concurrent package contains an extension to the Map interface called ConcurrentMap, which provides some extra methods described in following table. All of these methods perform a set of actions in the scope of a single atomic action. Performing this set of actions outside the map would introduce race conditions due to making multiple (non-atomic) calls on the map.</div><br><div></div><br><div><img src="/media/table-concurrent-map-methods.png" alt="table-concurrent-map-methods"><img src="file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/289ebe3f-9f50-4c78-bff7-2d9f1fbc287a.png" alt=""></div><br><div>There are two ConcurrentMap implementations available as shown in following table.</div><br><div><img src="/media/table-concurrent-map.png" alt="table-concurrent-map"><img src="file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/5a4f4218-f143-409f-a1c0-98c707b9dcaa.png" alt=""></div><br></div>

<h4 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h4><div>Queues act as pipes between “producers” and “consumers”.Items are put in one end of the pipe and emerge from the other end of the pipe in the same “fist-in fist-out” (FIFO) order.<br>The Queue interface was added to java.util in Java SE 5 and while it can be used in single-threaded scenarios, it is primarily used with multiple producers or one or more consumers, all writing and reading from the same queue.<br>The BlockingQueue interface is in java.util.concurrent and extends Queue to provide additional choices of how to handle the scenario where a queue may be full (when a producer adds an item) or empty (when a consumer reads or removes an item).<br>In these cases, BlockingQueue provides methods that either block forever or block for a specifid time period, waiting for the condition to change due to the actions of another thread.<br>The following table demonstrates the Queue and BlockingQueue methods in terms of key operations and the strategy for dealing with these special conditions.</div><br><div><img src="/media/table-concurrent-queue-methods.png" alt="table-concurrent-queue-methods"><img src="file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/b374c6dd-f4ae-4fe3-96fb-80233b3e1299.png" alt=""></div><br><div>Several Queue implementations are provided by the JDK and their relationships are discribed in the following table.</div><br><img src="/media/table-concurrent-queue.png" alt="table-concurrent-queue"><br><br>#### Deques<br><br><div>A double-ended queue or Deque (pronounced “deck”) was added in Java SE 6. Deques support not just adding from one end and removing from the other but adding and removing items from both ends. Similarly to BlockingQueue, there is a<br>BlockingDeque interface that provides methods for blocking and timeout in the case of special conditions. Table 7 shows the Deque and BlockingDeque methods. Because Deque extends Queue and BlockingDeque extends lockingQueue, all of those methods are also available for use.<br><img src="file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/307ab1f8-64da-4916-a6a7-ef6b431af845.png" alt=""><img src="/media/table-concurrent-deu-methods.png" alt="table-concurrent-deu-methods"></div><br><div>One special use case for a Deque is when add, remove, and examine operations all take place on only one end of the pipe. This special case is just a stack (fist-in-last-out retrieval order). The Deque interface actually provides methods that use the terminology of a stack: push() , pop() , and peek() . These methods map to addFirst() , removeFirst() , and peekFirst() methods in the Deque interface and allow you to use any Deque implementation as a stack. Table 8 describes the Deque and BlockingDeque implementations in the JDK. Note that Deque extends Queue and BlockingDeque extends BlockingQueue.</div><br><div><br><div><img src="/media/table-concurrent-deque.png" alt="table-concurrent-deque"><img src="file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/31906fc7-031c-4660-89d5-406daac22202.png" alt=""></div>

<h3 id="Threads"><a href="#Threads" class="headerlink" title="Threads"></a>Threads</h3><p></p></div><p></p>
<div>In Java, the java.lang.Thread class is used to represent an application or JVM thread. Code is always being executed in the context of some Thread class (use Thread.currentThread() to obtain your own Thread).</div>

<h4 id="Thread-interference"><a href="#Thread-interference" class="headerlink" title="Thread interference"></a>Thread interference</h4><div>The most obvious way to communicate between threads is for one thread to directly call a method on another Thread object. Table 9 shows methods on Thread that can be used for direct interaction across threads.</div><br><div><img src="/media/table-concurrent-thread.png" alt="table-concurrent-thread"></div><br><div></div><br><div><img src="/media/thread-inference.png" alt="thread-inference"></div><br>&gt; <div>NOTE: In current Thread implementation, suspend(), resume(), stop() are all deprecated. I guess there is a principle here: <em><strong>once started until destroyed, thread SHOULD determine its own life, except that it’s willing proactively to response the external interference: interruption, or some flag-base mechanics.</strong></em></div><br>&gt;<br>&gt; <div>So sleep(), yield(), join() are all for the current thread itself instead of controlling others.</div><br><div></div><br><div>Interruptible points are some points that can be interrupted or intend to accept interruption signal.</div><br><div>There are two ways to response interruption:</div><br>1)  some methods are interruptible. These method can throw InterruptedException, such as wait(), await() of CyclicBarrier and CountdownLatch, acquire() of Semophore<br><br>2)  some plain codes intend to handle interruption signal by using Thread.interrupted() to test interruption mark.<br><div></div><br><div>In current thread, the running code can do some actions to influence the current thread by sleep() or yield().</div><br><div><img src="/media/thread-current-context.png" alt="thread-current-context"><img src="file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/159e3222-f1a3-4ba4-806e-a79d29896d45.png" alt=""></div>

<h4 id="Uncaught-exception-handling"><a href="#Uncaught-exception-handling" class="headerlink" title="Uncaught exception handling"></a>Uncaught exception handling</h4><div>Threads can specify an UncaughtExceptionHandler that will receive notifiation of any uncaught exception that cause a thread to abruptly terminate.</div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Thread t = <span class="keyword">new</span> Thread(runnable);</div><div class="line">t.setUncaughtExceptionHandler(<span class="keyword">new</span> Therad.UncaughtExceptionHandler() &#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(Thread t, Throwable e)</span> </span>&#123;</div><div class="line">        <span class="comment">// get Logger and log uncaught exception</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">t.start();</div></pre></td></tr></table></figure><br><br></div>

<h4 id="Deadlock"><a href="#Deadlock" class="headerlink" title="Deadlock"></a>Deadlock</h4><div>A deadlock occurs when there is more than one thread, each waiting for a resource held by another, such that a cycle of resources and acquiring threads is formed. The most obvious kind of resource is an object monitor but any resource that causes blocking (such as wait / notify) can qualify.</div><br><div>Many recent JVMs can detect monitor deadlocks and will print deadlock information in thread dumps produced from a signal, jstack, or other thread dump tool.</div><br><div>In addition to deadlock, some other threading situations are starvation and livelock. Starvation occurs when threads hold a lock for long periods such that some threads “starve” without making progress. Livelock occurs when threads spend all of their time negotiating access to a resource or detecting and avoiding deadlock such that no thread actually makes<br>progress.<br><br>### Thread coordination<br><br></div>

<h4 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait / notify"></a>wait / notify</h4><div>The wait / notify idiom is appropriate whenever one thread needs to signal to another that a condition has been met, especially as an alternative to sleeping in a loop and polling the condition. For example, one thread might wait for a queue to contain an item to process. Another thread can signal the waiting threads when an item is added to the queue.<br>The canonical usage pattern for wait and notify is as follows:</div><br><div><br><div></div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Latch</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">waitTillChange</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span>(lock) &#123;</div><div class="line">            <span class="keyword">while</span>(! flag) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    lock.wait();</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="number">0</span> &#123;</span></span></div><div class="line">        <span class="keyword">synchronized</span>(lock) &#123;</div><div class="line">            flag = <span class="keyword">true</span>;</div><div class="line">            lock.notifyAll();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br>Some important things to note about this code:<br><br></div><br><div>• Always call wait, notify, and notifyAll inside a synchronized lock or an IllegalMonitorStateException will be thrown.<br>• Always wait inside a loop that checks the condition being waited on – this addresses the timing issue if another thread satisfis the condition before the wait begins. Also, it protects your code from spurious wake-ups that can (and do) occur.<br>• Always ensure that you satisfy the waiting condition before calling notify or notifyAll. Failing to do so will cause a notifiation but no thread will ever be able to escape its wait loop.</div>

<h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4><p></p></div><p></p>
<div>In Java SE 5, a new java.util.concurrent.locks.Condition class was added. Condition implements the wait/notify semantics in an API but with several additional features such as the ability to create multiple Conditions per Lock, interruptible waiting, access to statistics, etc. Conditions are obtained from a Lock instance as follows:</div><br><div><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LatchCondition</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Condition condition = lock.newCondition();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">waitTillChange</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.lock();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">while</span>(! flag) &#123;</div><div class="line">                condition.await();</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            lock.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.lock();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            flag = <span class="keyword">true</span>;</div><div class="line">            condition.signalAll();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            lock.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br></div>

<h4 id="Coordination-classes"><a href="#Coordination-classes" class="headerlink" title="Coordination classes"></a>Coordination classes</h4><div>The java.util.concurrent package contains several classes pre-built for common forms of multi-thread communication. These coordination classes cover most common scenarios where wait/notify and Condition might be used and are strongly perferred for their safety and ease of use.<br><strong>CyclicBarrier</strong><br>The CyclicBarrier is initialized with a participant count. Participants call await() and block until the count is reached, at which point an optional barrier task is executed by the last arriving thread, and all threads are released. The barrier can be reused indefiitely. Used to coordinate the start and stop of groups of threads.</div><br><div>字面意思循环挡板，通过它可以实现让一组线程等待至某个状态之后再全部同时执行。称为循环是因为当所有等待线程都被释放以后，CyclicBarrier可以被重用<br>Allows N-1 treads to wait on await() method until N-th thread calls await() method and then they resume their execution.<br><div class="separator"><img src="/media/CyclicBarrier.png" alt="CyclicBarrier"></div><br>As this illustration shows there is a barrier for 3 parties. When T1 and T2 come they wait. When T3 comes an optional TA handler is called and (after it completes?) T1,2,3 resume their work. You can reuse CyclicBarrier many times by calling reset() method.<br><br>And the code example:<br><div class="dp-highlighter"><br><div class="bar"><br><div class="tools"><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">final</span> CyclicBarrier cb = <span class="keyword">new</span> CyclicBarrier(N);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &amp;lt; N; i++) &#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> idx = i;</div><div class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            System.out.println(<span class="string">"T"</span> + idx + <span class="string">": await"</span>);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                cb.await();</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</div><div class="line">                System.out.println(<span class="string">"T"</span> + idx + <span class="string">": interrupted"</span>);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125; <span class="keyword">catch</span> (BrokenBarrierException ex) &#123;</div><div class="line">                System.out.println(<span class="string">"T"</span> + idx + <span class="string">": broken"</span>);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            System.out.println(<span class="string">"T"</span> + idx + <span class="string">": continue"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br></div><br></div><br></div><br>Console output:<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">T0: await</div><div class="line">T1: await</div><div class="line">T2: await</div><div class="line">T2: <span class="keyword">continue</span></div><div class="line">T1: <span class="keyword">continue</span></div><div class="line">T0: <span class="keyword">continue</span></div></pre></td></tr></table></figure><br><br>Lines can “jump” a little bit because threads in these examples print out information to console concurrently. So you may have slightly different results.<br><strong>CountDownLatch</strong><br>The CountDownLatch is initialized with a count. Threads may call await() to wait for the count to reach 0. Other threads (or same) may call countDown() to reduce count. Not reusable once the count has reached 0. Used to trigger an unknown set of threads once some number of actions has occurred.<br><br></div><br><div><br><br>倒计时闩, 利用它可以实现类似计数器的功能。比如有一个任务A，它要等待其他4个任务执行完毕之后才能执行，此时就可以利用CountDownLatch来实现这种功能了<br><br>Works like a counter – allows one or more threads to wait on await() method for another N threads to callcountDown() method N times (total number of calls should be N).<br><div class="separator"><img src="/media/CountdownLatch.png" alt="CountdownLatch"></div><br>As the illustration shows only T<span class="Apple-style-span">A</span> is awaiting. T<span class="Apple-style-span">1,2,3</span> call <span class="Apple-style-span">countDown()</span> and proceed their execution. When T<span class="Apple-style-span">3</span> calls<span class="Apple-style-span">countDown(),</span> T<span class="Apple-style-span">A</span> gets unlocked and can resume its work.<br><br>“HelloWorld app” for CountdownLatch:<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">final</span> CountDownLatch cdl = <span class="keyword">new</span> CountDownLatch(N);</div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                System.out.println(<span class="string">"awaiting..."</span>);</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    cdl.await();</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</div><div class="line">                    System.out.println(<span class="string">"await has been iterrupted"</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                System.out.println(<span class="string">"ready"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;).start();</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &amp;lt; N; i++) &#123;</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> idx = i;</div><div class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                    System.out.println(<span class="string">"T"</span> + idx + <span class="string">":countDown"</span>);</div><div class="line">                    cdl.countDown();</div><div class="line">                    System.out.println(<span class="string">"T"</span> + idx + <span class="string">":continue"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;).start();</div><div class="line">        &#125;</div></pre></td></tr></table></figure><br><br>Console output:<br><pre>awaiting…<br>T1:countDown<br>T0:countDown<br>T0:continue<br>T1:continue<br>T2:countDown<br>T2:continue<br>ready<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">It is different from CyclicBarrier:</div><div class="line">1) it cannot be reused, used only one time</div><div class="line">2) it does not block these N threads when they call countDown() method. Only thread on &lt;span class=&quot;Apple-style-span&quot;&gt;await()&lt;/span&gt; method waits.</div><div class="line"></div><div class="line">**Semaphore**</div><div class="line">A Semaphore manages a set of “permits” that can be checked out with acquire() which will block until one is available. Threads call release() to return the permit. A semaphore with one permit is equivalent to a mutual exclusion block.</div><div class="line"></div><div class="line">&lt;/div&gt;</div><div class="line">&lt;div&gt;</div><div class="line"></div><div class="line">Maintains N permits which is shared between M threads. Each thread can acquire or release permits. If there are not enough permits thread blocks until other threads release necessary amount of permits.</div><div class="line">&lt;div class=&quot;separator&quot;&gt;![Semaphore](/media/Semaphore.png)&lt;/div&gt;</div><div class="line">Let&apos;s see what is happening on the illustration above. There are 2 permits and 4 threads. Each thread acquires/releases only 1 permit. T&lt;span class=&quot;Apple-style-span&quot;&gt;1&lt;/span&gt; and T&lt;span class=&quot;Apple-style-span&quot;&gt;2&lt;/span&gt; do this and proceed their execution without being blocked. T&lt;span class=&quot;Apple-style-span&quot;&gt;3&lt;/span&gt; and T&lt;span class=&quot;Apple-style-span&quot;&gt;4&lt;/span&gt;block and wait for permits because there are no any permits available. T&lt;span class=&quot;Apple-style-span&quot;&gt;2&lt;/span&gt; releases one permit and T&lt;span class=&quot;Apple-style-span&quot;&gt;4&lt;/span&gt; proceeds its calculations&lt;span class=&quot;Apple-style-span&quot;&gt; (T&lt;span class=&quot;Apple-style-span&quot;&gt;3&lt;/span&gt; is also might be chosen?)&lt;/span&gt;. Next T&lt;span class=&quot;Apple-style-span&quot;&gt;4&lt;/span&gt; releases its permit and T&lt;span class=&quot;Apple-style-span&quot;&gt;3&lt;/span&gt; resumes. An finally T&lt;span class=&quot;Apple-style-span&quot;&gt;1&lt;/span&gt; and T&lt;span class=&quot;Apple-style-span&quot;&gt;3&lt;/span&gt; release their permits.</div><div class="line"></div><div class="line">Simple example:</div><div class="line">``` java</div><div class="line">public static void main(String args[]) &#123;</div><div class="line">    final Semaphore sem = new Semaphore(N);</div><div class="line">    acquire(&quot;T1&quot;, sem);</div><div class="line">    acquire(&quot;T2&quot;, sem);</div><div class="line"></div><div class="line">    release(&quot;Ta&quot;, sem);</div><div class="line">    release(&quot;Tb&quot;, sem);</div><div class="line">&#125;</div><div class="line"></div><div class="line">private static void acquire(final String id, final Semaphore s)&#123;</div><div class="line">    new Thread(new Runnable() &#123;</div><div class="line">        public void run() &#123;</div><div class="line">            System.out.println(id + &quot;: acquire&quot;);</div><div class="line">            try &#123;</div><div class="line">                s.acquire();</div><div class="line">            &#125; catch (InterruptedException ex) &#123;</div><div class="line">                System.out.println(id + &quot;: acquire|interrupted&quot;);</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">            System.out.println(id + &quot;: acquire|ready&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;).start();</div><div class="line">&#125;</div><div class="line"></div><div class="line">private static void release(final String id, final Semaphore s)&#123;</div><div class="line">    new Thread(new Runnable() &#123;</div><div class="line">        public void run() &#123;</div><div class="line">            System.out.println(id + &quot;: release&quot;);</div><div class="line">            s.release();</div><div class="line">            System.out.println(id + &quot;: release|ready&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br>Console output:<br><pre>T2: acquire<br>T2: acquire|ready<br>Tb: release<br>T1: acquire<br>Ta: release<br>Ta: release|ready<br>Tb: release|ready<br>T1: acquire|ready<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">**Exchanger**</div><div class="line">An Exchanger waits for threads to meet at the exchange() method and swap values atomically. This is similar to using a SynchronousQueue but data values pass in both directions.</div><div class="line"></div><div class="line">&lt;/div&gt;</div><div class="line">&lt;div&gt;&lt;/div&gt;</div><div class="line">&lt;div&gt;</div><div class="line"></div><div class="line">下面对上面说的三个辅助类进行一个总结：</div><div class="line"></div><div class="line">1）CountDownLatch和CyclicBarrier都能够实现线程之间的等待，只不过它们侧重点不同：</div><div class="line">CountDownLatch一般用于某个线程A等待若干个其他线程执行完任务之后，它才执行；</div><div class="line">而CyclicBarrier一般用于一组线程互相等待至某个状态，然后这一组线程再同时执行；</div><div class="line">另外，CountDownLatch是不能够重用的，而CyclicBarrier是可以重用的。</div><div class="line">2）Semaphore其实和锁有点类似，它一般用于控制对某组资源的访问权限。</div><div class="line"></div><div class="line">&lt;/div&gt;</div><div class="line"></div><div class="line">### Task execution</div><div class="line"></div><div class="line">&lt;div&gt;Many concurrent Java programs need a pool of workers executing tasks from a queue. The java.util.concurrent</div><div class="line">package provides a solid foundation for this style of work management.</div><div class="line"></div><div class="line">#### ExecutorService</div><div class="line"></div><div class="line">The Executor and more expansive ExecutorService interfaces defie the contract for a component that can execute</div><div class="line">tasks. Users of these interfaces can get a wide variety of implementation behaviors behind a common interface.</div><div class="line">The most generic Executor interface accepts jobs only in the form of Runnables:</div><div class="line">• void execute(Runnable command)</div><div class="line">The ExecutorService extends Executor to add methods that take both Runnable and Callable task and collections of tasks:</div><div class="line">• Future&amp;lt;?&amp;gt; submit(Runnable task)</div><div class="line">• Future&amp;lt;T&amp;gt; submit(Callable&amp;lt;T&amp;gt; task)</div><div class="line">• Future&amp;lt;T&amp;gt; submit(Runnable task, T result)</div><div class="line">• List&amp;lt;Future&amp;lt;T&amp;gt; invokeAll(Collection&amp;lt;? extends Callable&amp;lt;T&amp;gt;&amp;gt; tasks)</div><div class="line">• List&amp;lt;Future&amp;lt;T&amp;gt; invokeAll(Collection&amp;lt;? extends Callable&amp;lt;T&amp;gt;&amp;gt; tasks, long timeout, TimeUnit unit)</div><div class="line"></div><div class="line">&lt;/div&gt;</div><div class="line">&lt;div&gt;• T invokeAny(Collection&amp;lt;? extends Callable&amp;lt;T&amp;gt;&amp;gt; tasks)</div><div class="line">•T invokeAny(Collection&amp;lt;? extends Callable&amp;lt;T&amp;gt;&amp;gt; tasks, long timeout, TimeUnit unit)</div><div class="line"></div><div class="line">#### Callable and Future</div><div class="line"></div><div class="line">A Callable is like the familiar Runnable but can return a result and throw an exception:</div><div class="line">• V call() throws Exception;</div><div class="line">It is common in the executor framework to submit a Callable and receive a Future. A Future is a marker representing a result that will be available at some point in the future. The Future has methods that allow you to either poll or block while waiting for the result to be ready. You can also cancel the task before or while it’s executing through methods on Future.</div><div class="line">If you need the functionality of a Future where only Runnables are supported (as in Executor), you can use FutureTask as a bridge. FutureTask implements both Future and Runnable so that you can submit the task as a Runnable and use the task itself as a Future in the caller.</div><div class="line"></div><div class="line">#### ExecutorService implementations</div><div class="line"></div><div class="line">The primary implementation of ExecutorService is ThreadPoolExecutor. This implementation class provides a</div><div class="line">wide variety of confiurable features:</div><div class="line">• Thread pool – specify “core” thread count (optionally pre-started), and max thread count</div><div class="line">• Thread factory – generate threads with custom characteristics such as a custom name</div><div class="line">• Work queue – specify the queue implementation, which must be blocking, but can be bounded or unbounded</div><div class="line">• Rejected tasks – specify the policy for tasks that cannot be accepted due to a full input queue or unavailable worker</div><div class="line">• Lifecycle hooks – overridden to extend to override key points in the lifecycle like before or after task execution</div><div class="line">• Shutdown – stop incoming tasks and wait for executing tasks to complete ScheduledThreadPoolExecutor is an extension of ThreadPoolExecutor that provides the ability to schedule tasks for completion rather than using FIFO semantics. For cases where java.util.Timer is not sophisticated enough, the ScheduledThreadPoolExecutor often provides suffiient flxibility.</div><div class="line">The Executors class contains many static methods (see Table 10) for creating prepackaged ExecutorService and</div><div class="line">ScheduledExecutorService instances that will cover a wide variety of common use cases.</div><div class="line">![](file:///C:/Users/Administrator/Documents/My%20Knowledge/temp/98fb8f57-8cfd-441a-b0be-850e7533aebe.png)[![table-concurrent-executor](/media/table-concurrent-executor.png)](/media/table-concurrent-executor.png)</div><div class="line"></div><div class="line">&lt;/div&gt;</div><div class="line">&lt;div&gt;The following example creates a fied thread pool and submits a long-running task to it:&lt;/div&gt;</div><div class="line">&lt;div&gt;</div><div class="line">``` java</div><div class="line">int processors = Runtime.getRuntime().availableProcessor();</div><div class="line">ExecutorService excutor = Executors.newFixedThreadPool(processors);</div><div class="line">Future&amp;lt;Integer&amp;gt; futureResult = executor.submit(new Callable&amp;lt;Integer&amp;gt;() &#123;</div><div class="line">    public Integer call() &#123;</div><div class="line">        // long running computation that returns an integer</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">Integer result = futureResult.get(); //block for result</div></pre></td></tr></table></figure><br><br>In this example the call that submits the task to the executor will not block but return immediately. The last line will block on the get() call until the result is available.<br><br></pre></pre></div><br><div><br><br>ExecutorService covers almost all situations where you would previously create Thread objects or thread pools. Any time your code is constructing a Thread directly, consider whether you could accomplish the same goal with an ExecutorService  produced by one of the Executor factory methods; often this will be simpler and more flxible.<br><br>#### CompletionService<br><br>Beyond the common pattern of a pool of workers and an input queue, it is common for each task to produce a result that must be accumulated for further processing. The CompletionService interface allows a user to submit Callable and Runnable tasks but also to take or poll for results from the results queue:<br>• Future&lt;V&gt; take() – take if available<br>• Future&lt;V&gt; poll() – block until available<br>• Future&lt;V&gt; poll(long timeout, TimeUnit unit) – block until timeout ends<br>The ExecutorCompletionService is the standard implementation of CompletionService. It is constructed with an Executor that provides the input queue and worker thread pool.<br><br></div><br><div><br><br>&nbsp;<br><br><em> </em> *<br><br></div><br><div>Some thread-safe questions:</div><br><div>String  -&gt; immutable</div><br><div>StringBuffer -&gt; mutable, synchronized version</div><br><div>StringBuilder -&gt; mutable, unsynchronized version</div><br><div></div><br><div>HashMap -&gt;  unsynchronized</div><br><div>HashTable -&gt;  synchronized</div><br><div></div><br><div>ArrayList -&gt; unsynchronized</div><br><div>Vector -&gt; sysnchronized</div><br><div></div><br><div></div><br><div></div><br></div>
      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/03/04/postgresql-concurrency-with-mvcc/" rel="next" title="PostgreSQL Concurrency with MVCC">
                <i class="fa fa-chevron-left"></i> PostgreSQL Concurrency with MVCC
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/03/14/apache-maven-2/" rel="prev" title="Apache Maven 2">
                Apache Maven 2 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://qph.is.quoracdn.net/main-thumb-27403014-200-azcnfpakpayhgojvmueqcfjeyufbjpcx.jpeg"
               alt="Richard Yang" />
          <p class="site-author-name" itemprop="name">Richard Yang</p>
          <p class="site-description motion-element" itemprop="description">Nothing seek, nothing find</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">131</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://linkedin.com/in/richdyang" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://github.com/richdyang" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-github-alt"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://bitbucket.org/richdyang" target="_blank" title="Bitbucket">
                  
                    <i class="fa fa-fw fa-bitbucket"></i>
                  
                  Bitbucket
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://stackoverflow.com/users/4344443/richard" target="_blank" title="Stackoverflow">
                  
                    <i class="fa fa-fw fa-stack-overflow"></i>
                  
                  Stackoverflow
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://twitter.com/richdyang" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#A-birdview-of-core-java-concurrency"><span class="nav-number">1.</span> <span class="nav-text">A birdview of core java concurrency</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Concepts"><span class="nav-number">2.</span> <span class="nav-text">Concepts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Procting-shared-data"><span class="nav-number">3.</span> <span class="nav-text">Procting shared data</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Lock"><span class="nav-number">3.1.</span> <span class="nav-text">Lock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadWriteLock"><span class="nav-number">3.2.</span> <span class="nav-text">ReadWriteLock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#volatile"><span class="nav-number">3.3.</span> <span class="nav-text">volatile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Atomic-classes"><span class="nav-number">3.4.</span> <span class="nav-text">Atomic classes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ThreadLocal"><span class="nav-number">3.5.</span> <span class="nav-text">ThreadLocal</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Concurrent-collections"><span class="nav-number">4.</span> <span class="nav-text">Concurrent collections</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Concurrent-lists-and-sets"><span class="nav-number">4.1.</span> <span class="nav-text">Concurrent lists and sets</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Concurrent-maps"><span class="nav-number">4.2.</span> <span class="nav-text">Concurrent maps</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Queue"><span class="nav-number">4.3.</span> <span class="nav-text">Queue</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Threads"><span class="nav-number">5.</span> <span class="nav-text">Threads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Thread-interference"><span class="nav-number">5.1.</span> <span class="nav-text">Thread interference</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Uncaught-exception-handling"><span class="nav-number">5.2.</span> <span class="nav-text">Uncaught exception handling</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deadlock"><span class="nav-number">5.3.</span> <span class="nav-text">Deadlock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wait-notify"><span class="nav-number">5.4.</span> <span class="nav-text">wait / notify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Condition"><span class="nav-number">5.5.</span> <span class="nav-text">Condition</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Coordination-classes"><span class="nav-number">5.6.</span> <span class="nav-text">Coordination classes</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Richard Yang</span>
</div>

<!--div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div-->

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'richyang';
      var disqus_identifier = '2015/03/13/core-java-concurrency/';
      var disqus_title = 'Core Java Concurrency';

      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        run_disqus_script('embed.js');
      

    </script>
  




  
  

  

  

  
  

  
  
  
  <link rel="stylesheet" href="/vendors/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/vendors/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>



</body>
</html>
