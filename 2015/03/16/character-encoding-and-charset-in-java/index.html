<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Richard Yang, Java Developer, Senior software engineer" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="ConceptsAt the beginning, we need to distinguish some key concepts.
characterCharacter (aka. abstract character) is a textual representation of character.
glyphglyph is the particular images represent">
<meta property="og:type" content="article">
<meta property="og:title" content="Character encoding and charset in Java">
<meta property="og:url" content="https://richyang.me/2015/03/16/character-encoding-and-charset-in-java/index.html">
<meta property="og:site_name" content="Richard Yang">
<meta property="og:description" content="ConceptsAt the beginning, we need to distinguish some key concepts.
characterCharacter (aka. abstract character) is a textual representation of character.
glyphglyph is the particular images represent">
<meta property="og:image" content="https://docs.oracle.com/javase/tutorial/figures/i18n/000041.gif">
<meta property="og:image" content="https://docs.oracle.com/javase/tutorial/figures/i18n/0000df.gif">
<meta property="og:image" content="https://docs.oracle.com/javase/tutorial/figures/i18n/006771.gif">
<meta property="og:image" content="https://docs.oracle.com/javase/tutorial/figures/i18n/006771.gif">
<meta property="og:image" content="https://richyang.me/media/Character_encoding_and_charset_in_Java___Richard_Yang.png">
<meta property="og:image" content="https://richyang.me/media/java-utf-16be.png">
<meta property="og:image" content="https://richyang.me/media/character-api.png">
<meta property="og:image" content="https://richyang.me/media/string-api.png">
<meta property="og:image" content="https://richyang.me/media/how-long-string.png">
<meta property="og:image" content="https://richyang.me/media/jsp-directive-encoding.png">
<meta property="og:updated_time" content="2016-08-25T13:31:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Character encoding and charset in Java">
<meta name="twitter:description" content="ConceptsAt the beginning, we need to distinguish some key concepts.
characterCharacter (aka. abstract character) is a textual representation of character.
glyphglyph is the particular images represent">
<meta name="twitter:image" content="https://docs.oracle.com/javase/tutorial/figures/i18n/000041.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    },
    algolia: {
      applicationID: 'X0H1P7HDKY',
      apiKey: 'ddc0af00a6e07c9b1be9f4da4cf5b9d9',
      indexName: 'richyang.me',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>




  <title> Character encoding and charset in Java | Richard Yang </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <!--span class="logo-line-before"><i></i></span-->
      <span class="site-title">Richard Yang</span>
      <!--span class="logo-line-after"><i></i></span-->
    </a>
  </div>
  <p class="site-subtitle">Full-stack software engineer mainly focusing on Java-based technologies and web front-end</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Home
          </a>
        </li>
        
      
        
        
        <li class="menu-item menu-item-books">
          <a href="https://www.gitbook.com/@richdyang" rel="section">
            
            Books
          </a>
        </li>
        
      
        
        
        <li class="menu-item menu-item-showcase">
          <a href="/showcase" rel="section">
            
            Showcase
          </a>
        </li>
        
      
        
        
        <li class="menu-item menu-item-resume">
          <a href="http://linkedin.com/in/richdyang" rel="section">
            
            Résumé
          </a>
        </li>
        
      
        
        
      
        
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            About
          </a>
        </li>
        
      
        
        
      
        
        
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
            <i class="menu-item-icon fa fa-search fa-lg"></i>Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>

<div class="social-links" style="float: right; padding-left: 50px; margin-right: 10px">
      
        
          <span class="links-of-author-item">
            <a href="http://linkedin.com/in/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-linkedin"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://github.com/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-github-alt"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://bitbucket.org/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-bitbucket"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://stackoverflow.com/users/4344443/richard" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i>
                </span>
                 
              
            </a>
          </span>
        
          <span class="links-of-author-item">
            <a href="http://twitter.com/richdyang" target="_blank" style="border-bottom: none">
              
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-stack-1x fa-inverse fa-twitter"></i>
                </span>
                 
              
            </a>
          </span>
        
      
  </div>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Character encoding and charset in Java
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-03-16T19:08:24+08:00" content="2015-03-16">
              2015-03-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Basics/" itemprop="url" rel="index">
                    <span itemprop="name">Basics</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/16/character-encoding-and-charset-in-java/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/03/16/character-encoding-and-charset-in-java/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h1><p>At the beginning, we need to distinguish some key concepts.</p>
<h2 id="character"><a href="#character" class="headerlink" title="character"></a>character</h2><p>Character (aka. abstract character) is a textual representation of character.</p>
<h2 id="glyph"><a href="#glyph" class="headerlink" title="glyph"></a>glyph</h2><p>glyph is the particular images representing a character or part of a character. Glyphs for the same character may have very different shapes</p>
<h2 id="abstract-character-repertoire-ACR"><a href="#abstract-character-repertoire-ACR" class="headerlink" title="abstract character repertoire (ACR)"></a>abstract character repertoire (ACR)</h2><p>A <em>character repertoire</em> is the full set of unordered abstract characters that a system supports.</p>
<h2 id="coded-character-set-CCS"><a href="#coded-character-set-CCS" class="headerlink" title="coded character set (CCS)"></a>coded character set (CCS)</h2><p>A <em>coded character set</em> (CCS) specifies how to represent a repertoire of characters using a number of (typically non-negative) integer values called <span style="color: #ffffff; font-size: 20px; background-color: #000000;">code points</span>.</p>
<p>A complete set of characters and corresponding integers is a <em>coded character set</em>.</p>
<p>Multiple coded character sets may share the same repertoire.</p>
<h2 id="character-encoding-form-CEF"><a href="#character-encoding-form-CEF" class="headerlink" title="character encoding form (CEF)"></a><em>character encoding form</em> (CEF)</h2><p>A <em>character encoding form</em> (CEF) specifies the conversion of a coded character set’s integer codes into a set of limited-size integer <em>code values</em> that facilitate storage in a system that represents numbers in binary form using a fixed number of bits.</p>
<p>This is what a CEF accommodates: it defines a way of mapping a <em>single</em> code <em>point to a sequences of octets.</em></p>
<h2 id="character-encoding-scheme-CES"><a href="#character-encoding-scheme-CES" class="headerlink" title="character encoding scheme (CES)"></a>character encoding scheme (CES)</h2><p>a <em>character encoding scheme</em> (CES) specifies how the fixed-size integer code values should be mapped into an octet sequence suitable for saving on an octet-based file system or transmitting over an octet-based network.</p>
<table>
<thead>
<tr>
<th>Character encoding</th>
<th>Code unit width</th>
</tr>
</thead>
<tbody>
<tr>
<td>US-ASCII</td>
<td>7</td>
</tr>
<tr>
<td>UTF-8</td>
<td>8</td>
</tr>
<tr>
<td>EBCDIC</td>
<td>8</td>
</tr>
<tr>
<td>UTF-16</td>
<td>16</td>
</tr>
<tr>
<td>UTF-32</td>
<td>32</td>
</tr>
</tbody>
</table>
<p>Notice: although UTF-8 use the eight-unit <em>code unit</em>, but it doesn’t necessarily mean that each character is encoded as a single code unit. Actually, a character can be encoded as one or more than one <em>code units</em> in UTF-8.</p>
<p>For code unit including more thant 8 bits(byte), there is a problem named as <a href="http://en.wikipedia.org/wiki/Endianness" title="Endianness" target="_blank" rel="external">endian</a> (byte order). BE is big-endian, while LE is little-endian.</p>
<h1 id="Java-internal-string-representation"><a href="#Java-internal-string-representation" class="headerlink" title="Java internal string representation"></a>Java internal string representation</h1><p>Java uses UTF-16BE encoding as its internal representation.</p>
<blockquote>
<p>UTF-16 developed from an earlier fixed-width 16-bit encoding known as <strong>UCS-2</strong> (for 2-byte Universal Character Set) once it became clear that a fixed-width 2-byte encoding could not encode enough characters to be truly universal.</p>
<p>The encoding is <a href="http://en.wikipedia.org/wiki/Variable-width_encoding" title="Variable-width encoding" target="_blank" rel="external">variable-length</a>, as <a href="http://en.wikipedia.org/wiki/Code_point" title="Code point" target="_blank" rel="external">code points</a> are encoded with one or two 16-bit <em>code units</em>.<br>So, in Java:</p>
</blockquote>
<ul>
<li>a <em>code point</em> is a 32-bit <code>int</code> data type, where the lower 21 bits represent a valid code point value and the upper 11 bits are 0. (thus no negative code point)</li>
<li>a <em>code unit</em> is a 16-bit <code>char</code> value.<br>To express a Unicode character, the hexadecimal value is prefixed with the string U+.</li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Unicode Code Point</th>
<th>Glyph</th>
</tr>
</thead>
<tbody>
<tr>
<td>Latin A</td>
<td>U+0041</td>
<td><img src="https://docs.oracle.com/javase/tutorial/figures/i18n/000041.gif" alt="The Latin character A"></td>
</tr>
<tr>
<td>Latin sharp S</td>
<td>U+00DF</td>
<td><img src="https://docs.oracle.com/javase/tutorial/figures/i18n/0000df.gif" alt="The Latin small letter sharp S"></td>
</tr>
<tr>
<td>Han for East</td>
<td>U+6771</td>
<td><img src="https://docs.oracle.com/javase/tutorial/figures/i18n/006771.gif" alt="The Han character for east, eastern or eastward"></td>
</tr>
<tr>
<td>Deseret, LONG I</td>
<td>U+10400</td>
<td><img src="https://docs.oracle.com/javase/tutorial/figures/i18n/006771.gif" alt="The Han character for east, eastern or eastward"></td>
</tr>
</tbody>
</table>
<p>Characters that are in the range U+10000 to U+10FFFF are called supplementary characters. The set of characters from U+0000 to U+FFFF are sometimes referred to as the <em>Basic Multilingual Plane (BMP)</em>.</p>
<blockquote>
<p>U+10FFFF is the current upper limit of unicode defined code points.<br>Obviously, supplementary characters cannot be represented by a 16-bit <code>char.</code></p>
</blockquote>
<p>To support supplementary characters without changing the char primitive data type and causing incompatibility with previous Java programs, supplementary characters are defined by a pair of code point values that are called <em>surrogates</em>. The first code point is from the <em>high surrogates</em> range of <code>U+D800</code> to <code>U+DBFF</code>, and the second code point is from the <em>low surrogates</em> range of <code>U+DC00</code> to <code>U+DFFF</code>. You can simply think surogates ranges are the blocks reserved in BMP.</p>
<p><strong>Therefore, a unicode character can be represented by one <code>char</code> (BMP), or a surrogate pair (2 elements array of <code>char</code>).</strong></p>
<p>Until now, you shold be able to answer these questions:</p>
<ul>
<li>can any unicode character be represented by a Java char? No</li>
<li>how do we initialize a char exceeding BMP with char literals? No</li>
</ul>
<p>Simply, char ≠ unicode character</p>
<p><img src="/media/Character_encoding_and_charset_in_Java___Richard_Yang.png" alt="Character_encoding_and_charset_in_Java___Richard_Yang"><br>The table above shows some of the interesting things we have to look out for.</p>
<ol>
<li><p>Stored characters can take up an inconsistent number of bytes.<br>A UTF-8 encoded character might take between one (LATIN_CAPITAL_LETTER_A) and four (MATHEMATICAL_FRAKTUR_CAPITAL_G) bytes.<a href="http://en.wikipedia.org/wiki/Variable-width_encoding" target="_blank" rel="external">Variable width encoding</a> has implications for reading into and decoding from byte arrays.</p>
</li>
<li><p>Not all code points can be stored in a <code>char</code>.<br>The MATHEMATICAL_FRAKTUR_CAPITAL_G example lies in the supplementary range of characters and cannot be stored in 16 bits. It must be represented by two sequential <code>char</code> values, neither of which is meaningful by itself. The <a href="http://java.sun.com/javase/6/docs/api/java/lang/Character.html" target="_blank" rel="external">Character</a> class provides methods for working with 32-bit code points.</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Unicode code point to char array</span></div><div class="line"><span class="keyword">char</span>[] math_fraktur_cap_g = Character.toChars(<span class="number">0x1D50A</span>);</div></pre></td></tr></table></figure>
<ol>
<li>The relationship between the grapheme visible to the user and the code point type may not be 1:1.</li>
</ol>
<p>This can be seen in the combining character sequences (the e-acute example). As the Devenagari example shows, combining sequences can get quite complex.</p>
<p><img src="/media/java-utf-16be.png" alt="java-utf-16be"></p>
<h1 id="Character-and-String-API"><a href="#Character-and-String-API" class="headerlink" title="Character and String API"></a>Character and String API</h1><p><img src="/media/character-api.png" alt="character-api"></p>
<p><img src="/media/string-api.png" alt="string-api"></p>
<h2 id="How-long-is-a-string"><a href="#How-long-is-a-string" class="headerlink" title="How long is a string?"></a>How long is a string?</h2><ul>
<li><a href="http://java.sun.com/javase/6/docs/api/java/lang/String.html#length(" target="_blank" rel="external">String.length()</a>) returns the number of <code>char</code>s in the String. That’s also the number of code units.</li>
<li><a href="http://java.sun.com/javase/6/docs/api/java/lang/String.html#codePointCount(int,%20int" target="_blank" rel="external">String.codePointCount(int, int)</a>) returns the number of Unicode <strong>code points</strong> in the String.</li>
<li><a href="http://java.sun.com/javase/6/docs/api/java/text/BreakIterator.html#getCharacterInstance(java.util.Locale" target="_blank" rel="external">BreakIterator.getCharacterInstance()</a>) can be used to count the number of <strong>graphemes</strong> in a String.</li>
</ul>
<p><img src="/media/how-long-string.png" alt=""></p>
<h1 id="Play-with-charsets-and-encodings-in-Java"><a href="#Play-with-charsets-and-encodings-in-Java" class="headerlink" title="Play with charsets and encodings in Java"></a>Play with charsets and encodings in Java</h1><p>Here, the name of charset is misleading, actually it is defined as the combination of one or more coded character sets and a character-encoding scheme. If you are a serious programmer, you should read the Javadoc of class <code>Charset</code>.</p>
<p>Many non-unicode charsets are subsets of unicode, while others use completely different mapping between a character and its code point.</p>
<h2 id="Charset-CharsetEncoder-CharsetDecoder"><a href="#Charset-CharsetEncoder-CharsetDecoder" class="headerlink" title="Charset, CharsetEncoder/CharsetDecoder"></a>Charset, CharsetEncoder/CharsetDecoder</h2><p>Java provides a Charset class representing supported charset, by which we can encode Java string into bytes or decode bytes into Java String.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Charset.defaultCharset(); <span class="comment">// underlying OS encoding, you can modified it by System.setProperty("file.encoding", "your encoding here")</span></div></pre></td></tr></table></figure>
<blockquote>
<p>The “file.encoding” property is not required by the J2SE platform specification; it’s an internal detail of Sun’s implementations and should not be examined or modified by user code. It’s also intended to be read-only; it’s technically impossible to support the setting of this property to arbitrary values on the command line or at any other time during program execution.<br>Charset can get the CharsetEncoder and CharsetDecoder, by which you can control the entire encoding/decoding process.</p>
</blockquote>
<p>Charset.encode(..) and Charset.decode(..) are just the shortcut methods of using CharsetEncoder and CharsetDecoder.</p>
<p>Any place where you need to do byte-character conversion, you should specify the charset explicitly.</p>
<p>Some cases:</p>
<ul>
<li>String.getBytes()</li>
<li>Stream</li>
<li>file I/O</li>
</ul>
<h2 id="BOM-Byte-Order-Marker"><a href="#BOM-Byte-Order-Marker" class="headerlink" title="BOM (Byte Order Marker)"></a>BOM (Byte Order Marker)</h2><p>The code point for BOM is U+FEFF.</p>
<table>
<thead>
<tr>
<th>Charset</th>
<th>BOM byte sequence</th>
</tr>
</thead>
<tbody>
<tr>
<td>UTF-8 ef</td>
<td>bb bf</td>
</tr>
<tr>
<td>UTF-16BE</td>
<td>fe ff</td>
</tr>
<tr>
<td>UTF-16LE</td>
<td>ff fe</td>
</tr>
<tr>
<td>UTF-32BE</td>
<td>00 00 fe ff</td>
</tr>
<tr>
<td>UTF-32LE</td>
<td>ff fe 00 00</td>
</tr>
</tbody>
</table>
<p><strong>Some encodings will automatically emit byte order marks on encode and read them on decode.</strong></p>
<p>let’s test which charset insert BOM automatically:<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBOM</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// Encode this to get bytes</span></div><div class="line">        <span class="keyword">final</span> String bomChar = <span class="string">"\u0041"</span>;</div><div class="line">        <span class="comment">// Unicode encodings</span></div><div class="line">        String[] unicodeEncodings = &#123;<span class="string">"UTF-16"</span>, <span class="string">"UTF-8"</span>, <span class="string">"UTF-16BE"</span>, <span class="string">"UTF-16LE"</span>, <span class="string">"UTF-32BE"</span>, <span class="string">"UTF-32LE"</span>&#125;;</div><div class="line">        <span class="comment">// Print the byte order marks</span></div><div class="line">        <span class="keyword">for</span> (String encName : unicodeEncodings) &#123;</div><div class="line">            Charset charset = Charset.forName(encName);</div><div class="line">            <span class="keyword">byte</span>[] byteOrderMark = bomChar.getBytes(charset);</div><div class="line">            System.out.format(<span class="string">"%10s encoding: "</span>, charset.toString());</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">byte</span> b : byteOrderMark) &#123;</div><div class="line">                System.out.format(<span class="string">"%02x "</span>, b);</div><div class="line">            &#125;</div><div class="line">            System.out.println();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>Output:<br>UTF-16 encoding: fe ff 00 41<br>UTF-8 encoding: 41<br>UTF-16BE encoding: 00 41<br>UTF-16LE encoding: 41 00<br>UTF-32BE encoding: 00 00 00 41<br>UTF-32LE encoding: 41 00 00 00</p>
<p>You can see, UTF-16 encoding scheme inserts the UTF-16BE BOM automatically, while others don’t.</p>
<p>UTF-16 is also called <em>UTF-16BE with BOM</em>.</p>
<h2 id="pitfalls-of-encoding-and-decoding-data-corruption"><a href="#pitfalls-of-encoding-and-decoding-data-corruption" class="headerlink" title="pitfalls of encoding and decoding - data corruption"></a>pitfalls of encoding and decoding - data corruption</h2><p>When decoding not on one go, the character may become corrupted as two halves.</p>
<p>When encoding incrementally, some problems may happen: the <code>UTF-16</code> encoding scheme used adds a byte order mark to encoded data. Every time a string is written, another BOM is added, littering the content with unwanted data. When the data is decoded, extra characters end up in the text. All text would need to be concatenated and encoded in one go.</p>
<h1 id="environments-and-boundaries-JVM-interacts-with"><a href="#environments-and-boundaries-JVM-interacts-with" class="headerlink" title="environments and boundaries JVM interacts with"></a>environments and boundaries JVM interacts with</h1><p>If all your code is just running in JVM, you are OK. Once your JVM starts to interact with outer environment through I/O or network, that’s the boundary place that character en/decoding will happen.</p>
<h2 id="OS-locale"><a href="#OS-locale" class="headerlink" title="OS locale"></a>OS locale</h2><p>A <strong>locale</strong> is a set of parameters that defines the user’s language, country and any special variant preferences that the user wants to see in their user interface. Usually a locale identifier consists of at least a language identifier and a region identifier.</p>
<p>In Unix, Linux or like, the locale identifier is defined in this format: <tt>[language[_territory][.codeset][@modifier]]</tt></p>
<p>The locale settings usually include the following display (output) format settings:</p>
<ul>
<li>Number format setting</li>
<li>Character classification, case conversion settings</li>
<li>Date-time format setting</li>
<li>String <a href="http://en.wikipedia.org/wiki/Collation" title="Collation" target="_blank" rel="external">collation</a> setting</li>
<li>Currency format setting</li>
<li>Paper size setting</li>
<li>other minor settings …<br>In Windows, ……</li>
</ul>
<p>//TODO</p>
<h2 id="File-encoding"><a href="#File-encoding" class="headerlink" title="File encoding"></a>File encoding</h2><p>We say file encoding meas its content’s encoding (if it’s a text file) or it’s regarded as a storage of binary bytes.</p>
<p>Actually, file has no knowledge about its content encoding. Some tools can guess the encoding.</p>
<p>When you store the file in an encoding, and then open to show or interpret it in another encoding, I’m sure you’ll be frustrated with the <a href="http://en.wikipedia.org/wiki/Mojibake" target="_blank" rel="external">Mojibake</a>.</p>
<h2 id="HTML-charset-with-meta"><a href="#HTML-charset-with-meta" class="headerlink" title="HTML charset with meta"></a>HTML charset with meta</h2><p>There are two ways to specify the charset using HTML meta tag:</p>
<ul>
<li><meta charset="“utf-8”"></li>
<li><meta http-equiv="“Content-Type”" content="“text/html;" charset="utf-8”"><br>These two are equivalent.</li>
</ul>
<h2 id="HTTP-charset-with-Content-Type"><a href="#HTTP-charset-with-Content-Type" class="headerlink" title="HTTP charset with Content-Type"></a>HTTP charset with Content-Type</h2><p>HTTP header Content-Type can be set as “text/html; charset=UTF-8”. This is an indicator for browsers. It tells browsers to render or interpret this response context as UTF-8 HTML text.</p>
<h2 id="Servlet-JSP"><a href="#Servlet-JSP" class="headerlink" title="Servlet/JSP"></a>Servlet/JSP</h2><p>You tell the browser what encoding you are using, and you also need your server to produce the response of that encoding, whatever static html file, dynamic JSP or in-memory response stream.</p>
<p>JSP uses the directive:<br><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">contentType</span>=<span class="string">"text/html;charset=UTF-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"GBK"</span> %&gt;</span></div></pre></td></tr></table></figure></p>
<p>This means that this file is edited and stored using GBK encoding, but the server resonse as UTF-8 encoding.</p>
<p>So the pageEncoding attribute is for JVM to read the JSP source file content when run-time compiling.</p>
<p><img src="/media/jsp-directive-encoding.png" alt="jsp-directive-encoding"></p>
<p>For input data, you can use</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div></pre></td></tr></table></figure>
<h2 id="database-codepage-collation"><a href="#database-codepage-collation" class="headerlink" title="database codepage/collation"></a>database codepage/collation</h2><h1 id="Some-useful-sites"><a href="#Some-useful-sites" class="headerlink" title="Some useful sites"></a>Some useful sites</h1><p><a href="https://codepoints.net" target="_blank" rel="external">https://codepoints.net</a></p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/03/16/finally-execution-in-try-catch-finnally-blocks/" rel="next" title="finally execution in try-catch-finnally blocks">
                <i class="fa fa-chevron-left"></i> finally execution in try-catch-finnally blocks
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/03/16/equals-and-hashcode-contract/" rel="prev" title="equals() / hashCode() contract, Comparable contract">
                equals() / hashCode() contract, Comparable contract <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://qph.is.quoracdn.net/main-thumb-27403014-200-azcnfpakpayhgojvmueqcfjeyufbjpcx.jpeg"
               alt="Richard Yang" />
          <p class="site-author-name" itemprop="name">Richard Yang</p>
          <p class="site-description motion-element" itemprop="description">Nothing seek, nothing find</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">131</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://linkedin.com/in/richdyang" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://github.com/richdyang" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-github-alt"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://bitbucket.org/richdyang" target="_blank" title="Bitbucket">
                  
                    <i class="fa fa-fw fa-bitbucket"></i>
                  
                  Bitbucket
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://stackoverflow.com/users/4344443/richard" target="_blank" title="Stackoverflow">
                  
                    <i class="fa fa-fw fa-stack-overflow"></i>
                  
                  Stackoverflow
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://twitter.com/richdyang" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Concepts"><span class="nav-number">1.</span> <span class="nav-text">Concepts</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#character"><span class="nav-number">1.1.</span> <span class="nav-text">character</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#glyph"><span class="nav-number">1.2.</span> <span class="nav-text">glyph</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#abstract-character-repertoire-ACR"><span class="nav-number">1.3.</span> <span class="nav-text">abstract character repertoire (ACR)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#coded-character-set-CCS"><span class="nav-number">1.4.</span> <span class="nav-text">coded character set (CCS)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#character-encoding-form-CEF"><span class="nav-number">1.5.</span> <span class="nav-text">character encoding form (CEF)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#character-encoding-scheme-CES"><span class="nav-number">1.6.</span> <span class="nav-text">character encoding scheme (CES)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Java-internal-string-representation"><span class="nav-number">2.</span> <span class="nav-text">Java internal string representation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Character-and-String-API"><span class="nav-number">3.</span> <span class="nav-text">Character and String API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#How-long-is-a-string"><span class="nav-number">3.1.</span> <span class="nav-text">How long is a string?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Play-with-charsets-and-encodings-in-Java"><span class="nav-number">4.</span> <span class="nav-text">Play with charsets and encodings in Java</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Charset-CharsetEncoder-CharsetDecoder"><span class="nav-number">4.1.</span> <span class="nav-text">Charset, CharsetEncoder/CharsetDecoder</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BOM-Byte-Order-Marker"><span class="nav-number">4.2.</span> <span class="nav-text">BOM (Byte Order Marker)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pitfalls-of-encoding-and-decoding-data-corruption"><span class="nav-number">4.3.</span> <span class="nav-text">pitfalls of encoding and decoding - data corruption</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#environments-and-boundaries-JVM-interacts-with"><span class="nav-number">5.</span> <span class="nav-text">environments and boundaries JVM interacts with</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#OS-locale"><span class="nav-number">5.1.</span> <span class="nav-text">OS locale</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-encoding"><span class="nav-number">5.2.</span> <span class="nav-text">File encoding</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTML-charset-with-meta"><span class="nav-number">5.3.</span> <span class="nav-text">HTML charset with meta</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-charset-with-Content-Type"><span class="nav-number">5.4.</span> <span class="nav-text">HTTP charset with Content-Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Servlet-JSP"><span class="nav-number">5.5.</span> <span class="nav-text">Servlet/JSP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#database-codepage-collation"><span class="nav-number">5.6.</span> <span class="nav-text">database codepage/collation</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Some-useful-sites"><span class="nav-number">6.</span> <span class="nav-text">Some useful sites</span></a></li></ol></div>
            

          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Richard Yang</span>
</div>

<!--div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div-->

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'richyang';
      var disqus_identifier = '2015/03/16/character-encoding-and-charset-in-java/';
      var disqus_title = 'Character encoding and charset in Java';

      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        run_disqus_script('embed.js');
      

    </script>
  




  
  

  

  

  
  

  
  
  
  <link rel="stylesheet" href="/vendors/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/vendors/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>



</body>
</html>
