

From a file storing 4,000,000,000 unsigned integers (unsorted), check if a given number is in these integers.
The physical memory is 2G.

int[0]=1101 0010 0000 0000 0000 0010 1101 0000
means  4, 6, 7, 29 exist
int[1]=1101 0010 0000 0000 0000 0010 1101 0000
means 1*32 + (4, 6, 7, 29) exist
...
int[2^32/32] = ..

4 Bytes * 2^32/32 = 512M

```java
public class CheckExists {
    private final int SIZE = (int)(Math.pow(2, 32)/32);
    private int[] bitmap = new int[SIZE];
    private String fileName = "nums.txt";

    @Test
    public void test() throws IOException {
        buildBitmap();
        boolean exists = checkExists(28);
        System.out.println(exists);
    }

//    @Before
    public void setUp() throws IOException {
        URL fileUrl = getClass().getResource(fileName);

        BufferedWriter writer = new BufferedWriter(new FileWriter(fileUrl.getPath()));
        for(long i = 0; i < 400000000L; ++i) {
            int num = (int)(Math.random() * Integer.MAX_VALUE);
            if(num > Integer.MAX_VALUE) continue;
            writer.write(String.valueOf(num));
            writer.newLine();
        }
        writer.close();
    }

    public void buildBitmap() throws IOException {
        URL fileUrl = getClass().getResource(fileName);
        BufferedReader reader = new BufferedReader(new FileReader(fileUrl.getPath()));
        while(true) {
            String line = reader.readLine();
            if(line == null) break;
            int num = Integer.parseInt(line);

            int index = num / 32;
            int offset = num % 32;

            if(index >= SIZE) {
                System.out.println(num);
            }
            bitmap[index] = setBit(bitmap[index], offset);
        }
        reader.close();
    }

    public boolean checkExists(int i) {
        int index = i / 32;
        int offset = i % 32;
        return getBit(bitmap[index], offset) == 1;
    }

    private static int setBit(int i, int offset) {
        i |= 1 << offset;
        return i;
    }

    private static int getBit(int i, int offset) {
        return (i & 1 << offset) > 0 ? 1 : 0;
    }

    private static String toBinary(int i) {
        return toBinary(i, Integer.SIZE);
    }

    private static String toBinary(int i, int paddingTo) {
        StringBuilder sb = new StringBuilder(32);
        int nonZeroBits = Integer.SIZE - Integer.numberOfLeadingZeros(i);
        if(paddingTo < nonZeroBits) {
            throw new IllegalArgumentException(String.format("%d exceed padding length %d", i, paddingTo));
        }
        int needPadding = paddingTo - nonZeroBits;
        for(int j = 0; j < needPadding; j++) {
            sb.append('0');
        }
        if(nonZeroBits > 0) sb.append(Integer.toBinaryString(i));
        return sb.toString();
    }
}
```


