<!DOCTYPE HTML>
<html lang="en-us">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>JVM knowledge - Charvis Yang</title>
    <meta name="keywords" content="Java, Programming, Android, JavaScript, Angular, Kotlin, Swift, iOS, Machine Learning, Big Data">
    
    <meta property="og:title" content="JVM knowledge">
    <meta property="og:site_name" content="Charvis Yang">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="JVM knowledge - Charvis Yang" />
    <meta name="description" content="A Developer in New Zealand"> 
    
    <link rel="shortcut icon" href="http://yangchao.me/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://yangchao.me/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://yangchao.me/img/apple-touch-icon.png" />
    <link href="http://yangchao.me/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://yangchao.me/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://yangchao.me/css/main.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/kotlin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/swift.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/typescript.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://yangchao.me/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Charvis Yang</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Nothing seek, nothing find</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://yangchao.me/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://www.gitbook.com/@charvisyang" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Books
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://yangchao.me/showcase/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-code"></i> <br />Showcase
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://linkedin.com/in/charvisyang" rel="section">
              <i class="menu-item-icon fa fa-fw fa-linkedin"></i> <br />Résumé
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://yangchao.me/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archive
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://yangchao.me/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About
          </a>
        </li>
      
    </ul>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://yangchao.me/post/jvm-knowledge/" itemprop="url">
        JVM knowledge
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">Published at:</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2015-04-18">
    2015-04-18
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">Categories:</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://yangchao.me/categories/jvm" itemprop="url" rel="index">
        <span itemprop="name">JVM</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">Reading:</span>
<span class="leancloud-visitors-count">1182 words ~6min</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    

<p>references:</p>

<ul>
<li>&lt;<a href="https://www.artima.com/insidejvm/ed2/index.html">Inside the Java Virtual Machine</a>&gt;</li>
<li>&lt;<a href="https://docs.oracle.com/javase/specs/jvms/se7/html/">Java Virtual Machine specification</a> 7&gt;</li>
</ul>

<h3 id="run-time-data-areas">run-time data areas</h3>

<p><img src="http://yangchao.me/media/jvm.png" alt="jvm" /></p>

<h4 id="pc-registers">pc registers</h4>

<p>Every JVM thread has its own pc(program counter) register.</p>

<p>The pc register is one word in size, so it can hold both a native pointer and a <code>returnAddress</code>.</p>

<p>If a thread is executing a native method, the value of the pc register is undefined.</p>

<h4 id="jvm-stacks">JVM stacks</h4>

<p>Every thread has a private JVM stacks. It stores frames.</p>

<p>It can be of fixed size or dynamically expanded and contracted as required.</p>

<p>The JVM only performs two operations directly on Java Stacks: it pushes and pops frames.</p>

<p><img src="http://yangchao.me/media/jvm-stacks-per-thread.png" alt="jvm-stacks-per-thread" /></p>

<h4 id="heap-script-src-file-c-program-files-x86-eudic-dat-res-main-js-type-text-javascript-script">heap <script src="file:///c:\program files (x86)\eudic\dat\res\main.js" type="text/javascript"></script></h4>

<blockquote>
<div id="ID679732753" class="explain_wrap">

<div id="ID679732753Child" class="expDiv"><span style="color: #0000cd;">hiːp</span></div>

<p></div>
The JVM has a heap. It stores all class instances and arrays.</p>
</blockquote>

<p>Heap storage for objects is reclaimed by an automatic storage management system (aka. GC or garbage collector).</p>

<p>It can be of fixed size or dynamically expanded as required by the computation and may be contracted if larger heap becomes unnecessary.</p>

<p>JVM provides options for <strong>initial size</strong>, and  if the heap can be dynamically expanded or contracted, users can control over the <strong>maximum and minimum size</strong> of the heap.</p>

<h4 id="method-area">method area</h4>

<p>It&rsquo;s logically part of the heap. It stores per-class structures, such as the run-time constant pool, field and method data and the code for methods and constructors (including special methods like &lt;init&gt; and &lt;clinit&gt;).</p>

<p>&nbsp;</p>

<p>per-class structure(class data) includes:</p>

<h5 id="type-information">Type Information</h5>

<ul>
<li>The fully qualified name of the type</li>
<li>The fully qualified name of the type&rsquo;s direct superclass (unless the type is an interface or class <code>java.lang.Object</code>, neither of which have a superclass)</li>
<li>Whether or not the type is a class or an interface</li>
<li>The type&rsquo;s modifiers ( some subset ofpublic<code>,</code>abstract<code>,</code>final`)</li>
<li>An ordered list of the fully qualified names of any direct superinterfaces</li>
</ul>

<h5 id="run-time-constant-pool">run-time Constant Pool</h5>

<p>A constant pool is an ordered set of constants used by the type, including literals (string, integer, and floating point constants) and symbolic references to types, fields, and methods.</p>

<p>These symbolic references to all types, fields, and methods used by a type, the constant pool plays a central role in the <strong><em>dynamic linking</em></strong> of Java programs.</p>

<h5 id="field-information">Field Information</h5>

<ul>
<li>The field&rsquo;s name</li>
<li>The field&rsquo;s type</li>
<li>The field&rsquo;s modifiers (some subset of <code>public</code>, <code>private</code>, <code>protected</code>, <code>static</code>, <code>final</code>, <code>volatile</code>, <code>transient</code>)</li>
</ul>

<h5 id="method-information">Method Information</h5>

<ul>
<li>The method&rsquo;s name</li>
<li>The method&rsquo;s return type (or <code>void</code>)</li>
<li>The number and types (in order) of the method&rsquo;s parameters</li>

<li><p>The method&rsquo;s modifiers (some subset of <code>public</code>, <code>private</code>, <code>protected</code>, <code>static</code>, <code>final</code>, <code>synchronized</code>, <code>native</code>, <code>abstract</code>)
for non-abstract method:</p></li>

<li><p>The method&rsquo;s bytecodes</p></li>

<li><p>The sizes of the operand stack and local variables sections of the method&rsquo;s stack frame (these are described in a later section of this chapter)</p></li>

<li><p>An exception table</p></li>
</ul>

<h5 id="class-variables">Class Variables</h5>

<p>JVM must allocate memory from the method area for each non-final class variable declared in the class.</p>

<p>final class variable (constant) is not here, they are in constant pool instead.</p>

<h5 id="a-reference-to-class-classloader">A Reference to Class <code>ClassLoader</code></h5>

<p>The virtual machine must store a reference to the user-defined class loader that loaded the type. (if the type is loaded by bootstrap class loader, the reference is not required)
&gt; NOTICE: method area just stores the reference to ClassLoader. The ClassLoader instance itself is allocated in the heap.</p>

<h5 id="a-reference-to-class-class">A Reference to Class <code>Class</code></h5>

<blockquote>
<p>NOTICE: method area just stores the reference to Class. The Class instance itself is allocated in the heap.</p>
</blockquote>

<h5 id="method-tables">Method Tables</h5>

<p>A method table is an array of direct references to all the instance methods that may be invoked on a class instance, including instance methodsinherited from superclasses.</p>

<p>A method table allows a virtual machine to quickly locate an instance method invoked on an object.</p>

<p><img src="http://yangchao.me/media/method-area-and-heap.gif" alt="method-area-and-heap" /></p>

<h3 id="run-time-data-structures">run-time data structures</h3>

<h4 id="run-time-constant-pool-1">run-time constant pool</h4>

<p>It&rsquo;s a per-class or per-interface representation of the <span style="font-family: 'courier new', courier;">constant_pool</span> table in a <span style="font-family: 'courier new', courier;">class</span> file.</p>

<p>It&rsquo;s constructed when the class or the interface created by JVM.</p>

<h4 id="frames">frames</h4>

<p>A frame is used to store data and partial result, as well as to perform dynamic linking, return values for methods and dispatch exceptions.</p>

<p>It&rsquo;s created each time a method is invoked.</p>

<p>Frames could be allocated on a contiguous stack, or they could be allocated on a heap, or some combination of both.</p>

<p>In a given thread of control, only the frame for the executing method is active. This active frame is calls <strong>current frame</strong>, and the executing method is called <strong>current method</strong>. The class in which the current method is defined is called** current class**.</p>

<p><img src="http://yangchao.me/media/16fig03.gif" alt="16fig03" /></p>

<p>Now we will go to the components of a frame:</p>

<h5 id="local-variables">local variables</h5>

<p>Each frame contains an array of local variables known as <em>local variables</em>.</p>

<p>The length of the local variable array can be determined at compile-time and supplied in a binary class file.</p>

<ul>
<li>A single variable can hold a value of type <span style="font-family: 'courier new', courier;">boolean, byte, char, short, int, float, reference, or returnAddress</span>.</li>
<li>A pair of variables can hold a value of type<span style="font-family: 'courier new', courier;"> long, double</span>.
On class method invocation, any parameters are passed in from local variable 0.</li>
</ul>

<p>On instance method invocation, local variable 0 is always the reference to the instance object. (aka, <span style="font-family: 'courier new', courier;">this</span>)</p>

<pre><code class="language-java">class Example3a {

    public static int runClassMethod(int i, long l, float f,
        double d, Object o, byte b) {

        return 0;
    }

    public int runInstanceMethod(char c, double d, short s,
        boolean b) {

        return 0;
    }
}
</code></pre>

<p><img src="http://yangchao.me/media/method-parameters-on-local-variables.png" alt="method-parameters-on-local-variables" /></p>

<h5 id="operand-stack">operand stack</h5>

<p>Each frame contains a LIFO stack known as <em>operand stack</em>. It&rsquo;s mainly for operations on operands and partial/intermediate result storage.</p>

<p>The maximum depth of the operand stack can be determined at compile-time and supplied in a binary class file.</p>

<p>operations on operand stack:</p>

<ul>
<li>load constants or values from local variables onto the operand stack</li>
<li>tack operands from the operand stack, operate on them, and push the result onto the operand stack.</li>
</ul>

<pre><code class="language-java">int c = a + b
</code></pre>

<p>The above source code has the instructions:</p>

<pre><code class="language-java">iload_0    // push the int in local variable 0
iload_1    // push the int in local variable 1
iadd       // pop two ints, add them, push result
istore_2   // pop int, store into local variable 2
</code></pre>

<p><img src="http://yangchao.me/media/add-two-local-variables.png" alt="add-two-local-variables" /></p>

<h5 id="frame-data">Frame Data</h5>

<p>The Java stack frame includes data to support constant pool resolution, normal method return, and exception dispatch, also some implementation dependent information, such as data to support debugging.</p>

<h6 id="normal-method-invocation-completion">normal method invocation completion</h6>

<p>When normal completion, the frame of current method is popped and the return value (if any) is pushed onto the operand stack of the invoker&rsquo;s frame.</p>

<h6 id="abrupt-method-invocation-completion">abrupt method invocation completion</h6>

<p>Every method is associated with zero or more <em>exception handlers</em>.</p>

<p>When an exception occurs, the JVM searches for a matching exception handler in the current method.</p>

<p>When no such exception handler is found to handle the exception, the current method invocation completes abruptly. At this time, the operand stack and local variables of the current method invocation are discarded, and its frame is popped. Then the exception is rethrowed in the context of the invoker&rsquo;s frame and so on.</p>

<p>If no suitable exception handler is found before the top of method invocation chain is reached, the execution of the thread is terminated.</p>

<p>The following is an possible implementation which allocates frames from the heap.</p>

<p><img src="http://yangchao.me/media/frames-in-heap.png" alt="frames-in-heap" /></p>

<h3 id="class-file-format">class file format</h3>

<p>This is about binary representation of a class.</p>

<h3 id="loading-linking-and-initializing">loading, linking and initializing</h3>

<p>This is for run-time representation of a class.</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

    </div>
    <footer class="post-footer">
     

     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://yangchao.me/post/apache-cxf-and-axis-2-tutorial/" rel="next" title="Apache CXF and Axis 2 tutorial">
        <i class="fa fa-chevron-left"></i> Apache CXF and Axis 2 tutorial
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://yangchao.me/post/garbage-collection/" rel="prev" title="Garbage Collection">
        Garbage Collection <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     




    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

  <ul class="sidebar-nav motion-element">
    <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
      Table of Content
    </li>
    <li class="sidebar-nav-overview" data-target="site-overview">
      Site Information
    </li>
  </ul>

    <section class="site-overview sidebar-panel ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://yangchao.me/img/author.jpg"
        alt="Charvis" />
    <p class="site-author-name" itemprop="name">Charvis</p>
    <p class="site-description motion-element" itemprop="description"> 
        Programmer &amp; Life explorer</p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://yangchao.me/post/">
        <span class="site-state-item-count">134</span>
        <span class="site-state-item-name">Blogs</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://yangchao.me/categories/">       
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">Categories</span>
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://yangchao.me/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">Tags</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/charvisyang" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
        <span class="links-of-author-item">
        <a href="https://linkedin.com/charvisyang" target="_blank" title="Linkedin">
            <i class="fa fa-fw fa-linkedin"></i>
            Linkedin
        </a>
        </span>
    
</div>

      
      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
    <div class="post-toc">
        <div class="post-toc-content"><nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#run-time-data-areas">run-time data areas</a>
<ul>
<li><a href="#pc-registers">pc registers</a></li>
<li><a href="#jvm-stacks">JVM stacks</a></li>
<li><a href="#heap-script-src-file-c-program-files-x86-eudic-dat-res-main-js-type-text-javascript-script">heap <script src="file:///c:\program files (x86)\eudic\dat\res\main.js" type="text/javascript"></script></a></li>
<li><a href="#method-area">method area</a>
<ul>
<li><a href="#type-information">Type Information</a></li>
<li><a href="#run-time-constant-pool">run-time Constant Pool</a></li>
<li><a href="#field-information">Field Information</a></li>
<li><a href="#method-information">Method Information</a></li>
<li><a href="#class-variables">Class Variables</a></li>
<li><a href="#a-reference-to-class-classloader">A Reference to Class <code>ClassLoader</code></a></li>
<li><a href="#a-reference-to-class-class">A Reference to Class <code>Class</code></a></li>
<li><a href="#method-tables">Method Tables</a></li>
</ul></li>
</ul></li>
<li><a href="#run-time-data-structures">run-time data structures</a>
<ul>
<li><a href="#run-time-constant-pool-1">run-time constant pool</a></li>
<li><a href="#frames">frames</a>
<ul>
<li><a href="#local-variables">local variables</a></li>
<li><a href="#operand-stack">operand stack</a></li>
<li><a href="#frame-data">Frame Data</a>
<ul>
<li><a href="#normal-method-invocation-completion">normal method invocation completion</a></li>
<li><a href="#abrupt-method-invocation-completion">abrupt method invocation completion</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#class-file-format">class file format</a></li>
<li><a href="#loading-linking-and-initializing">loading, linking and initializing</a></li>
</ul></li>
</ul></li>
</ul>
</nav></div>
    </div>
</section>

  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
   - 2017</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">Charvis Yang</span>
</div>
<div class="powered-by">
  Powered by - <a class="theme-link" href="http://gohugo.io" target="_blank" title="hugo" >Hugo</a>
</div>
<div class="theme-info">
  Theme by - <a class="theme-link" href="https://github.com/xtfly/hugo-theme-next" target="_blank"> NexT
  </a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?0b07433b4ab8d587dae7d34e71973839";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=58416275" charset="UTF-8"></script> 
<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://yangchao.me/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://yangchao.me/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://yangchao.me/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://yangchao.me/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://yangchao.me/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://yangchao.me/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://yangchao.me/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://yangchao.me/js/utils.js"></script>
<script type="text/javascript" src="http://yangchao.me/js/motion.js"></script>
<script type="text/javascript" src="http://yangchao.me/js/affix.js"></script>
<script type="text/javascript" src="http://yangchao.me/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://yangchao.me/js/scrollspy.js"></script>
<script type="text/javascript" src="http://yangchao.me/js/post-details.js"></script>
<script type="text/javascript" src="http://yangchao.me/js/toc.js"></script>

<script type="text/javascript" src="http://yangchao.me/js/bootstrap.js"></script>

</body>
</html>